---
format: html
editor: visual
---

# Libro de códigos {#codebook}

## Introducción

Para el uso adecuado de la base de datos Encuesta Panel Justicia Educacional y Ciudadanía, recomendamos que los investigadores trabajen con el libro de códigos que se presenta a continuación. Esta sección busca facilitar el uso de la base de datos, entregando la información correspondiente a los nombres de las variables, sus etiquetas, así como también las etiquetas de las categorías de respuesta de cada variable. En primer lugar, se detallan las instrucciones de cómo utilizar el libro de códigos interactivo. En segundo lugar, se presenta el libro de códigos propiamente tal para cada cuestionario por separado (estudiantes, docentes y padres y apoderados).

## Instrucciones

Los Libros de Códigos que se presentan en la siguiente sección corresponden a una herramienta interactiva que busca presentar de manera eficiente información respecto a las variables que componen la base de datos. Presentamos los ítems por cuestionario para facilitar su comprensión.

Cada libro muestra el código de cada variable, la etiqueta asociada a la variable con la redacción del ítem, y las categorías de respuesta y códigos asociados. Estas corresponden a tres columnas del libro de códigos denominadas ***name, label*** y ***value_label***, respectivamente.

Se puede hacer uso del buscador que se encuentra al principio del libro para encontrar información de manera más rápida. También se pueden usar los buscadores por cada columna, los cuales irán filtrando los datos que contengan el término de búsqueda.

Incluimos etiquetas de variables en el Libro de Códigos y en las bases de datos. El equipo de EDUMER las diseñó con la intención de describir brevemente el fenómeno o dimensión a medir. La redacción de la pregunta sigue a las etiquetas, incluyendo códigos y categorías de respuesta. En la construcción de la base de datos, ingresamos los códigos de respuesta como valores numéricos y las categorías de respuesta como etiquetas.

En la columna ***value_labels*** se muestran las categorías de respuesta de cada variable. No obstante, si la variable es numérica o de respuesta abierta (texto), la casilla se mostrará en blanco, ya que no hay ninguna categoría que mostrar. También puede ocurrir el caso que la variable sea numérica, pero tenga disponibles las categorías "88. No Sabe" y "99. No Responde". En estos casos sólo se visualizarán ambas categorías en el libro de código.

```{r setup, include=FALSE}
library(knitr)
knitr::opts_chunk$set(echo = F,
                      warning = F,
                      error = F, 
                      message = F) 
```

```{r packages}
if (!require("pacman")) install.packages("pacman")

pacman::p_load(tidyverse,
               here, 
               codebook,DT, haven, sjlabelled)

options(scipen=999)
rm(list = ls())
```



```{r data, include=FALSE}
file.exists(here("output/data", "data-060125.RData"))
load(file = here("output/data", "data-060125.RData"))


url <- "https://raw.githubusercontent.com/educacion-meritocracia/survey-edumer-fgz/refs/heads/main/input/Cuestionario_edumer.xlsx%20-%20survey.csv"

url2 <- "https://raw.githubusercontent.com/educacion-meritocracia/survey-edumer-fgz/refs/heads/main/input/cohesion%20-%20survey.csv"


cuestionario_data <- read_csv(url)
cuestionario_data2<- read.csv(url2)


```


```{r code 1, echo=FALSE}

#Agregar labels de cuestionario a data 

library(labelled)
var_label(data$merit_01)


cuestionario_data <- cuestionario_data %>% select(name, label)

df<- data.frame(matrix(ncol=nrow(cuestionario_data),nrow= 0))
colnames(df) <- cuestionario_data$name
df <- df %>%
  dplyr::select(starts_with("carac_"), starts_with("merit_"), starts_with("des"))
                
# Paso 2: Filtrar 'labels' para incluir solo columnas que existen en 'df'
filtered_labels <- cuestionario_data %>%
  filter(name %in% colnames(df))
# Asignar las etiquetas como atributos solo para columnas existentes
for (i in seq_along(filtered_labels$name)) {
  attr(df[[filtered_labels$name[i]]], "label") <- as.character(filtered_labels$label[i]) # Asegurar que sean strings
}

#Categorías de respuesta para las variables del módulo meritocracia
for (var in names(df)[grepl("^merit_", names(df))]) {
  df[[var]] <- set_labels(
    df[[var]], 
    labels = c(`1` = "Muy en desacuerdo",
                           `2` = "En desacuerdo",
                           `3` = "De acuerdo",
                           `4` = "Muy de acuerdo",
                           `5` = "No sé",
                           `6` = "Preferiría no responder"
  ))
  }

#proceso para módulo de cohesión

cuestionario_data2 <- cuestionario_data2 %>% select(name, label)

df1<- data.frame(matrix(ncol=nrow(cuestionario_data2),nrow= 0))
colnames(df1) <- cuestionario_data2$name
df1 <- df1 %>%
  dplyr::select(starts_with("cohesion_"), starts_with("values_"))
                
# Paso 2: Filtrar 'labels' para incluir solo columnas que existen en 'df1'
filtered_labels_cohesion <- cuestionario_data2 %>%
  filter(name %in% colnames(df1))
# Asignar las etiquetas como atributos solo para columnas existentes
for (i in seq_along(filtered_labels_cohesion$name)) {
  attr(df1[[filtered_labels_cohesion$name[i]]], "label") <-as.character(filtered_labels_cohesion$label[i]) # Asegurar que sean strings
}

#Categorías de respuesta para las variables del módulo cohesión

for (var in names(df1)[grepl("^cohesion_", names(df))]) {
  df[[var]] <- set_labels(
    df[[var]], 
    labels = c(`1` = "Para nada",
                           `2` = "Más bien no",
                           `3` = "En parte",
                           `4` = "Más bien sí",
                           `5` = "Totalmente",
                           `6` = "No sé",
                           `7` = "Preferiría no responder"
  ))
  }


```



## Caracterización

```{r code2, echo=FALSE}



#no son likert las variables des_04, des_05 y des_06

#Categorías de respuesta módulo Caracterización

#carac_a04
df$carac_a04 <- set_labels(
    df$carac_a4, labels = c(`1` = "Mapuche",
                           `2` = "Aimara",
                           `3` = "Rapa Nui",
                           `4` = "Quechua",
                           `5` = "No, a ninguno de los anteriores",
                           `6`= "No sé",
                           `7`= "Preferiría no responder"
                                                  ))
#carac_a05
df$carac_a05 <- set_labels(
    df$carac_a05, labels = c(`1` = "Católico",
                           `2` = "Evangélico",
                           `3` = "Protestante",
                           `4` = "Judío",
                           `5` = "Creyente no adherente",
                           `6`= "Agnóstico",
                           `7`= "Ninguna",
                           `8`= "No sé",
                           `9`= "Preferiría no responder"))

#carac_a06

df$carac_a06 <- set_labels(
    df$carac_a06, labels = c(`1` = "Entre 0 y 10 libros",
                           `2` = "Entre 11 y 25 libros",
                           `3` = "Entre 26 y 100 libros",
                           `4` = "Entre 101 y 200",
                           `5` = "Entre 201 y 500",
                           `6`= "Más de 500 libros",
                           `7`= "No sé",
                           `8`= "Preferiría no responder"))


#carac_a07
df$carac_a07 <- set_labels(
    df$carac_a07, labels = c(`1` = "Colegio municipal",
                           `2` = "Colegio particular subvencionado",
                           `3` = "Colegio particular",
                           `4`= "No sé",
                           `5`= "Preferiría no responder"))


#carac_a08
df$carac_a08 <- set_labels(
    df$carac_a08, labels = c(`1` = "Derecha",
                           `2` = "Centro derecha",
                           `3` = "Centro",
                           `4` = "Centro izquierda",
                           `5` = "Izquierda",
                           `6`= "Independiente",
                           `7`= "Ninguna",
                           `8`= "No sé",
                           `9`= "Preferiría no responder"))


#carac_a09
df$carac_a09 <- set_labels(
    df$carac_a09, labels = c(`1` = "Aprueba",
                           `2` = "Desaprueba",
                           `8`= "No sé",
                           `9`= "Preferiría no responder"))


#carac_a10
df$carac_a05 <- set_labels(
    df$carac_a05, labels = c(`1` = "Católico",
                           `2` = "Evangélico",
                           `3` = "Protestante",
                           `4` = "Judío",
                           `5` = "Creyente no adherente",
                           `6`= "Agnóstico",
                           `7`= "Ninguna",
                           `8`= "No sé",
                           `9`= "Preferiría no responder"))

#carac_a12
df$carac_a12 <- set_labels(
    df$carac_a12, labels = c(`1` = "Chile",
                           `2` = "Venezuela",
                           `3` = "Bolivia",
                           `4` = "Perú",
                           `5` = "Colombia",
                           `6`= "Haití",
                           `7`= "Ecuador",
                           `8`= "Argentina",
                           `9`= "República Dominicana",
                           `10`= "España",
                           `11`= "Brasil",
                           `12`= "Cuba",
                           `13` = "Paraguay",
                           `14` = "Otro"))


#Categorías de respuesta para las variables carac_a13, carac_a14, carac_a15,carac_a16

df <- set_labels(
    df %>% c(carac_a13,carac_a14,carac_a15,carac_a16), labels = c(`1` = "Sí",
                           `2` = "No",
                           `3` = "No sé",
                           `4` = "Preferiría no responder"))




codebook :: label_browser_static(df)

```


## Meritocracia

```{r code3, echo=FALSE}

data_meritocracia <- filtered_labels [15:24,]


codebook:::label_browser_static(df)
```

## Cohesión social

```{r code4, echo=FALSE}


data_cohesion <- filtered_labels2 []

codebook:::label_browser_static(data_cohesion)

```



## Valores sociales 

```{r code5, echo= FALSE}




```


## Viñetas

```{r code 6, echo= FALSE}




```

